---
title: "YouTube_Trending_Videos_Exploration_615_Final_Project"
author: "YuzheHuang"
date: "12/11/2019"
output: pdf_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE,warning = FALSE)
setwd("C:/Users/huang/Desktop/615 final project")

library("wordcloud", lib.loc="~/R/win-library/3.6")
library("wordcloud2", lib.loc="~/R/win-library/3.6")
library(SnowballC)
library(tokenizers)
library("tidytext", lib.loc="~/R/win-library/3.6")
library("textdata", lib.loc="~/R/win-library/3.6")
library("ggplot2")
library("ggmap", lib.loc="~/R/win-library/3.6")
library("maps", lib.loc="~/R/win-library/3.6")
library("sp", lib.loc="~/R/win-library/3.6")
library("maptools", lib.loc="~/R/win-library/3.6")
library(rjson)
library(jsonlite)
library(tidyverse)
library(RColorBrewer)
library(scales)
library("webshot", lib.loc="~/R/win-library/3.6")
library("htmlwidgets", lib.loc="~/R/win-library/3.6")

#Import data and data cleaning
us<-read.csv("US.csv",header = TRUE)
uscategory<-fromJSON("US_category_id.json")

ca<-read.csv("CA.csv",header = TRUE)
cacategory<-fromJSON("CA_category_id.json")

de<-read.csv("DE.csv",header = TRUE)
decategory<-fromJSON("DE_category_id.json")

fr<-read.csv("FR.csv",header = TRUE)
frcategory<-fromJSON("FR_category_id.json")

gb<-read.csv("GB.csv",header = TRUE)
gbcategory<-fromJSON("GB_category_id.json")

ind<-read.csv("IN.csv",header = TRUE)
indcategory<-fromJSON("IN_category_id.json")

jp<-read.csv("JP.csv",header = TRUE)
jpcategory<-fromJSON("JP_category_id.json")

kr<-read.csv("KR.csv",header = TRUE)
krcategory<-fromJSON("KR_category_id.json")

mx<-read.csv("MX.csv",header = TRUE)
mxcategory<-fromJSON("MX_category_id.json")

ru<-read.csv("RU.csv",header = TRUE)
rucategory<-fromJSON("RU_category_id.json")

category_id<-as.vector(uscategory$items$id)
category_name<-as.vector(uscategory$items$snippet$title)
uscategoryname<-as.data.frame(cbind(category_id,category_name))
uscategoryname$category_id<-as.numeric(levels(uscategoryname$category_id))[uscategoryname$category_id]
uss<-us%>%left_join(uscategoryname,by="category_id")

category_id<-as.vector(cacategory$items$id)
category_name<-as.vector(cacategory$items$snippet$title)
cacategoryname<-as.data.frame(cbind(category_id,category_name))
cacategoryname$category_id<-as.numeric(levels(cacategoryname$category_id))[cacategoryname$category_id]
cas<-ca%>%left_join(cacategoryname,by="category_id")
cas<-cas[,-c(9:34)]
cas<-cas[!is.na(cas$category_name),]


category_id<-as.vector(decategory$items$id)
category_name<-as.vector(decategory$items$snippet$title)
decategoryname<-as.data.frame(cbind(category_id,category_name))
decategoryname$category_id<-as.numeric(levels(decategoryname$category_id))[decategoryname$category_id]
des<-de%>%left_join(decategoryname,by="category_id")
des<-des[,-c(9:34)]


category_id<-as.vector(frcategory$items$id)
category_name<-as.vector(frcategory$items$snippet$title)
frcategoryname<-as.data.frame(cbind(category_id,category_name))
frcategoryname$category_id<-as.numeric(levels(frcategoryname$category_id))[frcategoryname$category_id]
fr$category_id<-as.numeric(fr$category_id)
frs<-fr%>%left_join(frcategoryname,by="category_id")
frs<-frs[!is.na(frs$category_name),]
frs<-frs[,-c(9:47)]


category_id<-as.vector(gbcategory$items$id)
category_name<-as.vector(gbcategory$items$snippet$title)
gbcategoryname<-as.data.frame(cbind(category_id,category_name))
gbcategoryname$category_id<-as.numeric(levels(gbcategoryname$category_id))[gbcategoryname$category_id]
gbs<-gb%>%left_join(gbcategoryname,by="category_id")
gbs<-gbs[,-c(9:34)]


category_id<-as.vector(indcategory$items$id)
category_name<-as.vector(indcategory$items$snippet$title)
indcategoryname<-as.data.frame(cbind(category_id,category_name))
indcategoryname$category_id<-as.numeric(levels(indcategoryname$category_id))[indcategoryname$category_id]
ind$category_id<-as.numeric(ind$category_id)
inds<-ind%>%left_join(indcategoryname,by="category_id")
inds<-inds[!is.na(inds$category_name),]
inds<-inds[,-c(9:26)]



category_id<-as.vector(jpcategory$items$id)
category_name<-as.vector(jpcategory$items$snippet$title)
jpcategoryname<-as.data.frame(cbind(category_id,category_name))
jpcategoryname$category_id<-as.numeric(levels(jpcategoryname$category_id))[jpcategoryname$category_id]
jp$category_id<-as.numeric(jp$category_id)
jps<-jp%>%left_join(jpcategoryname,by="category_id")


category_id<-as.vector(krcategory$items$id)
category_name<-as.vector(krcategory$items$snippet$title)
krcategoryname<-as.data.frame(cbind(category_id,category_name))
krcategoryname$category_id<-as.numeric(levels(krcategoryname$category_id))[krcategoryname$category_id]
kr$category_id<-as.numeric(kr$category_id)
krs<-kr%>%left_join(krcategoryname,by="category_id")
krs<-krs[,-c(9:41)]


category_id<-as.vector(mxcategory$items$id)
category_name<-as.vector(mxcategory$items$snippet$title)
mxcategoryname<-as.data.frame(cbind(category_id,category_name))
mxcategoryname$category_id<-as.numeric(levels(mxcategoryname$category_id))[mxcategoryname$category_id]
mx$category_id<-as.numeric(mx$category_id)
mxs<-mx%>%left_join(mxcategoryname,by="category_id")
mxs<-mxs[,-c(9:37)]


category_id<-as.vector(rucategory$items$id)
category_name<-as.vector(rucategory$items$snippet$title)
rucategoryname<-as.data.frame(cbind(category_id,category_name))
rucategoryname$category_id<-as.numeric(levels(rucategoryname$category_id))[rucategoryname$category_id]
ru$category_id<-as.numeric(ru$category_id)
rus<-ru%>%left_join(rucategoryname,by="category_id")
rus<-rus[,-c(9:37)]



```


# Introduction

YouTube is one of the largest video hosting websites in the world, which has profound influences on the society in all aspects. Therefore, analyzing of YouTube’s dataset become significant for advertisers and investors to analyze the social trends and make a prediction for future strategic business planning. 

<br>

**Therefore, the key objectives of the report are as follows:**

* Find the view patterns of YouTube videos by region;
* Select the category that have relatively higher business potential by constructing evaluation matrix;
* Explore the popular words used in the YouTube trending videos.


# Data Description

## Datasets

* The dataset includes daily trending YouTube videos of 10 countries: United States, United Kingdom, Germany, Canada, France, Japan, Korea, Mexico, Russia and India.
* Trending time interval: 2017.11-2018.6.
* The variables used contain: video id, trending date, category id, category name, publish time, views, likes, dislikes, comment count.  
* Source: <https://www.kaggle.com/datasnaek/youtube-new#header>

```{r,out.width = '70%'}
geo<-read.csv("geo data.csv",header = TRUE)
visit.x<-geo$Longitude
visit.y<-geo$Latitude
mp<-NULL
mapworld<-borders("world",colour = "black",fill="white")
mp<-ggplot()+mapworld+ylim(-60,90) 
mp+geom_point(aes(x=visit.x,y=visit.y),color=brewer.pal(11, "RdBu")[2])+scale_size(range=c(2,9))+ggtitle("Distribution of Countries in Dataset")+theme(plot.title=element_text(size=10,color="red",face="italic"))+theme_grey(base_size=10)+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank())+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+theme(axis.text.x = element_blank())+theme(axis.ticks.x = element_blank())+theme(plot.title = element_text(hjust = 0.5))
 






```



## Data Processing

* Drop null values and corrected time format;
* Pair the category ids with their names for further analysis.

# Exploratory Data Analysis

## 1. View pattern

<br>
**1.1 Top 5 Most Viewed YouTube Categories (by country)**
<br>

* Entertainment videos are most viewed in six out of ten countries (Figure 1-6), followed by music videos dominated both in UK and U.S. (Figure 7,8).
* Indian viewers like auto and vehicle videos best (Figure 9), while French prefer game streaming (Figure 10).

```{r,fig.height = 3.5, fig.width = 3.5}
##Korea
category_view<-krs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-13,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 1. Korea")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Russia
category_view<-rus%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-11,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 2. Russia")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Germany
category_view<-des%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 3. Germany")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Mexico
category_view<-mxs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-13,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 4. Mexico")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Japan
category_view<-jps%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-15,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 5. Japan")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Canada
category_view<-cas%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 6. Canada")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Great Britain
category_view<-gbs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-13,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 7. United Kingdom")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 
ggsave("gb_trending_views_bar_all.png",height = 10,width = 10)

##us
category_view<-summarise(group_by(uss,category_name),sum(as.numeric(views)))
category_view<-category_view[order(category_view$`sum(as.numeric(views))`,decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$`sum(as.numeric(views))`),y=category_view$`sum(as.numeric(views))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 8. United States")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##India
category_view<-inds%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 9. India")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##France
category_view<-frs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 10. France")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 


```

## 1. View pattern

<br>
**1.2 Top 5 Most Rated YouTube Categories (by country)**   
<br>

* In terms of likes and dislikes, similarly, videos regarding to entertainment (Figure 11-13), music (Figure 14-17), gaming and auto (Figure 18-20)gain most popularity.

* The percentage of dislikes in music videos is generally lower than that in other three Top 1 genres, which indicates that music videos are more acceptable than others and thus a “safe” choice for advertiser.


```{r,fig.height = 3.5, fig.width = 3.5}
##Korea
category_likes<-summarise(group_by(krs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(krs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 11. Korea")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Mexico
category_likes<-summarise(group_by(mxs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(mxs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 12. Mexico")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Canada
category_likes<-summarise(group_by(cas,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(cas,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 13. Canada")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##us
category_likes<-summarise(group_by(uss,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(uss,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 14. United States")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Russia
category_likes<-summarise(group_by(rus,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(rus,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 15. Russia")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Germany
category_likes<-summarise(group_by(des,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(des,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 16. Germany")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))


##Japan
category_likes<-summarise(group_by(jps,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(jps,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 17. Japan")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##United Kingdom
category_likes<-summarise(group_by(gbs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(gbs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 18. United Kindom")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##India
category_likes<-summarise(group_by(inds,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(inds,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 19. India")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##France
category_likes<-summarise(group_by(frs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(frs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 20. France")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

```

## 1. View pattern

<br>

**1.3 Top 5 Most Commented YouTube Categories (by country)**   
<br>

* Entertainment (Figure 21-24), music (Figure 25-28), gaming and auto videos’(Figure 29-30) influence continues…

```{r,fig.height = 3.5, fig.width = 3.5 }
##Russia
category_comments<-summarise(group_by(rus,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 21. Russia")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Germany
category_comments<-summarise(group_by(des,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 22. Germany")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Mexico
category_comments<-summarise(group_by(mxs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 23. Mexico")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Canada
category_comments<-summarise(group_by(cas,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 24. Canada")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##us
category_comments<-summarise(group_by(uss,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 25. United States")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Great Britain
category_comments<-summarise(group_by(gbs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 26. United Kingdom")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Japan
category_comments<-summarise(group_by(jps,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 27. Japan")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Korea
category_comments<-summarise(group_by(krs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 28. Korea")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##France
category_comments<-summarise(group_by(frs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 29. France")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##India
category_comments<-summarise(group_by(inds,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 30. India")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())


```

## 1. View pattern
<br>

**1.4 Top 5 Most Popular YouTube Categories (by country)**

<br>

* Finally, according to the times that videos went on charts, the four categories (Entertainment, Music, Auto and Gaming, see Figure 31-39) still dominate, which indicates that the views, likes, dislikes and number of comments are correlated with whether a video goes on chart. 

* Besides, people and blog (Figure 40) videos gain ground in Russia. 

```{r,fig.height = 3.5, fig.width = 3.5}
##Korea
category_count<-krs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 31. Korea")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Germany
category_count<-des%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 32. Germany")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Mexico
category_count<-mxs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 33. Mexico")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Japan
category_count<-jps%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 34. Japan")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Canada
category_count<-cas%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 35. Canada")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##us
category_count<-uss%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 36. United States")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Uk
category_count<-gbs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 37. United Kingdom")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##India
category_count<-inds%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 38. India")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##France
category_count<-frs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 39. France")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Russia
category_count<-rus%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 40. Russia")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

```

## 2. User participation

- User participation is broke down into two parts: 
  + showing their attitude to the videos, i.e. clicking “likes and dislikes”;
  + leaving comments on videos.
<br>
- The average voting rate, 3% of ten countries is 10 times of the average comment rate,0.3% (red lines in the figures below): 
  + Voting rate of a video=(likes+dislikes)/views X 100%;
  + Comment rate of a video=(# of comments)/views X 100%.
<br>
- The British show the least willingness to rate and comment on videos, while Russians are enthusiastic about doing so, which could be partly explained by culture difference.

```{r,fig.height = 7, fig.width = 7}
#Combine 10 contries' data into one data frame
country<-rep("us",length(uss$video_id))
usss<-cbind(uss,country)
country<-rep("ca",length(cas$video_id))
cass<-cbind(cas,country)
country<-rep("de",length(des$video_id))
dess<-cbind(des,country)
country<-rep("fr",length(frs$video_id))
frss<-cbind(frs,country)
country<-rep("gb",length(gbs$video_id))
gbss<-cbind(gbs,country)
country<-rep("ind",length(inds$video_id))
indss<-cbind(inds,country)
country<-rep("jp",length(jps$video_id))
jpss<-cbind(jps,country)
country<-rep("kr",length(krs$video_id))
krss<-cbind(krs,country)
country<-rep("mx",length(mxs$video_id))
mxss<-cbind(mxs,country)
country<-rep("ru",length(rus$video_id))
russ<-cbind(rus,country)
total<-rbind(usss,cass,dess,frss,gbss,indss,jpss,krss,mxss,russ)
total<-total[!is.na(total$category_name),]



#global
#Calculate comment/views and (likes+dislikes)/views 
total<-mutate(total,cv=as.numeric(comment_count)/as.numeric(views),av=(as.numeric(likes)+as.numeric(dislikes))/as.numeric(views))

total<-mutate(total,trending_year=substr(trending_date,1,2),trending_month=substr(trending_date,7,8))
total_month<-total%>%group_by(trending_year,trending_month)%>%summarise(comments_month=sum(as.numeric(comment_count),na.rm = TRUE),attitude_month=sum(as.numeric(likes)+as.numeric(dislikes),na.rm = TRUE),views_month=sum(as.numeric(views),na.rm = TRUE))
total_month<-mutate(total_month,cv=as.numeric(comments_month)/as.numeric(views_month),av=(as.numeric(attitude_month))/as.numeric(views_month))


#by region
total_month_region<-total%>%group_by(country,trending_year,trending_month)%>%summarise(comments_month=sum(as.numeric(comment_count),na.rm = TRUE),attitude_month=sum(as.numeric(likes)+as.numeric(dislikes),na.rm = TRUE),views_month=sum(as.numeric(views),na.rm = TRUE))
total_month_region<-mutate(total_month_region,cv=as.numeric(comments_month)/as.numeric(views_month),av=(as.numeric(attitude_month))/as.numeric(views_month))

total_month_region<-left_join(total_month_region,total_month,by=c("trending_year" , "trending_month"))

total_month_region<-mutate(total_month_region,date=paste(trending_year,trending_month,sep="-"))
total_month_region<-mutate(total_month_region,date=paste("20",date,sep=""))
colnames(total_month_region)[8]<-"av_region"
colnames(total_month_region)[7]<-"cv_region"
colnames(total_month_region)[12]<-"cv_global"
colnames(total_month_region)[13]<-"av_global"

ggplot(total_month_region)+geom_point(mapping=aes(x=as.character(date),y=av_region,color=country))+guides(color=guide_legend(title=NULL))+theme(legend.text = element_text(color="azure4", size = 8, face = "bold"))+theme(axis.text.x=element_text(size = 6))+geom_line(mapping = aes(x=as.character(date),y=av_global,group=1),size=2,colour=brewer.pal(11, "RdBu")[2])+theme(panel.background = element_rect(fill = "transparent",colour = NA),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+labs(title="Figure 41. Average Voting Rate")+
  labs(x="Time", y="Average Voting Rate") +scale_color_discrete(labels = c('United States','Canada','Germany','France','United Kingdom','India','Japan','Korea','Mexico','Russia'))+annotate("text", x=8, y=0.028, label="Overall Voting Rate",colour=brewer.pal(11, "RdBu")[2])

ggplot(total_month_region)+geom_point(mapping=aes(x=as.character(date),y=cv_region,color=country))+guides(color=guide_legend(title=NULL))+theme(legend.text = element_text(color="azure4", size = 8, face = "bold"))+theme(axis.text.x=element_text(size = 6))+geom_line(mapping = aes(x=as.character(date),y=cv_global,group=1),size=2,colour=brewer.pal(11, "RdBu")[2])+theme(panel.background = element_rect(fill = "transparent",colour = NA),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+labs(title="Figure 42. Average Comment Rate")+
  labs(x="Time", y="Average Comment Rate") +scale_color_discrete(labels = c('United States','Canada','Germany','France','United Kingdom','India','Japan','Korea','Mexico','Russia'))+annotate("text", x=7, y=0.0025, label="Overall Comment Rate",colour=brewer.pal(11, "RdBu")[2])




```

## 3. Trending Lifecycle

*"Trending lifecycle is from the moment the video is published to the last trending date on the charts"*
<br>
**Metrics explanation**
<br>

- I focus on: Average going-viral time=Initial trending date-publish date
  + Average trending days=Final trending date-Initial trending date
<br>

- The average going-viral time for each category describes on average how fast a video can show up on the trending charts. The longer time interval is, the larger the time cost will be.


<br>
**Insights from visuals** 

<br>

- By country
  + Average going-viral time: In most countries, it took **1-3 days** for a video to go viral (Figure 41-48). However, in U.S and UK, it took **1-2 weeks** (Figure 49-50). 
<br>
- By category
  + Average going viral time: Music videos take the longest time to go viral on YouTube. This may explained by the fact that:
    * Music videos normally lack breath-taking storylines, so they take time to attract audience;
    * There exist other more focused music video platforms, like Vimeo and TikTok, making audience switching to them.

```{r,fig.height = 3.5, fig.width = 3.5}
#Trending Lifecycle
##publish to initial trending
#Japan
jpd<-jp%>%mutate(p1<-paste(str_sub(as.character(jp$trending_date),1,2),str_sub(as.character(jp$trending_date),7,8),str_sub(as.character(jp$trending_date),4,5),sep="-"))
jpd<-jpd%>%mutate(p2<-paste("20",jpd$`... <- NULL`,sep = ""))
colnames(jpd)[9]<-"trendingdate"
colnames(jpd)[10]<-"trending_date_final"

jpd<-mutate(jpd,pub<-substr(publish_time,1,10))
colnames(jpd)[11]<-"pub"
jpd$pub<-as.Date(jpd$pub)
jpd<-mutate(jpd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(jpd$gov)[2])
q3<-as.vector(summary(jpd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

jpdgov_prep<-jpd[-as.vector(which(jpd$gov>shangjie)),]
jpgov<-jpdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
jpgov<-left_join(jpgov,cacategoryname,by="category_id")
jpgov<-jpgov[-15,]

ggplot(jpgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 41. Japan")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y=element_blank())+theme()+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#Russia
rud<-ru%>%mutate(p1<-paste(str_sub(as.character(ru$trending_date),1,2),str_sub(as.character(ru$trending_date),7,8),str_sub(as.character(ru$trending_date),4,5),sep="-"))
rud<-rud%>%mutate(p2<-paste("20",rud$`... <- NULL`,sep = ""))
rud<-rud[,-c(9:37)]
colnames(rud)[9]<-"trendingdate"
colnames(rud)[10]<-"trending_date_final"

rud<-mutate(rud,pub<-substr(publish_time,1,10))
colnames(rud)[11]<-"pub"
rud$pub<-as.Date(rud$pub)
rud<-mutate(rud,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(rud$gov)[2])
q3<-as.vector(summary(rud$gov)[5])
shangjie<-q3+1.5*(q3-q1)

rudgov_prep<-rud[-as.vector(which(rud$gov>shangjie)),]
rugov<-rudgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
rugov<-left_join(rugov,cacategoryname,by="category_id")
rugov<-rugov[-15,]

ggplot(rugov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 42. Russia")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#France
frd<-fr%>%mutate(p1<-paste(str_sub(as.character(fr$trending_date),1,2),str_sub(as.character(fr$trending_date),7,8),str_sub(as.character(fr$trending_date),4,5),sep="-"))
frd<-frd%>%mutate(p2<-paste("20",frd$`... <- NULL`,sep = ""))
frd<-frd[,-c(9:47)]
colnames(frd)[9]<-"trendingdate"
colnames(frd)[10]<-"trending_date_final"


frd<-mutate(frd,pub<-substr(publish_time,1,10))
colnames(frd)[11]<-"pub"
frd$pub<-as.Date(frd$pub)
frd<-mutate(frd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(frd$gov)[2])
q3<-as.vector(summary(frd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

frdgov_prep<-frd[-as.vector(which(frd$gov>shangjie)),]
frgov<-frdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
frgov$category_id<-as.numeric(frgov$category_id)
frgov<-left_join(frgov,cacategoryname,by="category_id")
frgov<-frgov[!is.na(frgov$govtime),]
frgov<-frgov[!is.na(frgov$category_name),]

ggplot(frgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 43. France")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#Mexico
mxd<-mx%>%mutate(p1<-paste(str_sub(as.character(mx$trending_date),1,2),str_sub(as.character(mx$trending_date),7,8),str_sub(as.character(mx$trending_date),4,5),sep="-"))
mxd<-mxd%>%mutate(p2<-paste("20",mxd$`... <- NULL`,sep = ""))
mxd<-mxd[,-c(9:37)]
colnames(mxd)[9]<-"trendingdate"
colnames(mxd)[10]<-"trending_date_final"



mxd<-mutate(mxd,pub<-substr(publish_time,1,10))
colnames(mxd)[11]<-"pub"
mxd$pub<-as.Date(mxd$pub)
mxd<-mutate(mxd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(mxd$gov)[2])
q3<-as.vector(summary(mxd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

mxdgov_prep<-mxd[-as.vector(which(mxd$gov>shangjie)),]
mxgov<-mxdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
mxgov<-left_join(mxgov,cacategoryname,by="category_id")
mxgov<-mxgov[-15,]

ggplot(mxgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 44. Mexico")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#Germany
ded<-de%>%mutate(p1<-paste(str_sub(as.character(de$trending_date),1,2),str_sub(as.character(de$trending_date),7,8),str_sub(as.character(de$trending_date),4,5),sep="-"))
ded<-ded%>%mutate(p2<-paste("20",ded$`... <- NULL`,sep = ""))
ded<-ded[,-c(9:34)]
colnames(ded)[9]<-"trendingdate"
colnames(ded)[10]<-"trending_date_final"



ded<-mutate(ded,pub<-substr(publish_time,1,10))
colnames(ded)[11]<-"pub"
ded$pub<-as.Date(ded$pub)
ded<-mutate(ded,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(ded$gov)[2])
q3<-as.vector(summary(ded$gov)[5])
shangjie<-q3+1.5*(q3-q1)

dedgov_prep<-ded[-as.vector(which(ded$gov>shangjie)),]
degov<-dedgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
degov<-left_join(degov,cacategoryname,by="category_id")

ggplot(degov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 45. Germany")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))


#canada
cad<-ca%>%mutate(p1<-paste(str_sub(as.character(ca$trending_date),1,2),str_sub(as.character(ca$trending_date),7,8),str_sub(as.character(ca$trending_date),4,5),sep="-"))
cad<-cad%>%mutate(p2<-paste("20",cad$`... <- NULL`,sep = ""))
cad<-cad[,-c(9:34)]
colnames(cad)[9]<-"trendingdate"
colnames(cad)[10]<-"trending_date_final"

cad<-mutate(cad,pub<-substr(publish_time,1,10))
colnames(cad)[11]<-"pub"
cad$pub<-as.Date(cad$pub)
cad<-mutate(cad,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(cad$gov)[2])
q3<-as.vector(summary(cad$gov)[5])
shangjie<-q3+1.5*(q3-q1)

cadgov_prep<-cad[-as.vector(which(cad$gov>shangjie)),]
cagov<-cadgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
cagov<-left_join(cagov,cacategoryname,by="category_id")

ggplot(cagov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 46. Canada")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#Korea
krd<-kr%>%mutate(p1<-paste(str_sub(as.character(kr$trending_date),1,2),str_sub(as.character(kr$trending_date),7,8),str_sub(as.character(kr$trending_date),4,5),sep="-"))
krd<-krd%>%mutate(p2<-paste("20",krd$`... <- NULL`,sep = ""))
krd<-krd[,-c(9:41)]
colnames(krd)[9]<-"trendingdate"
colnames(krd)[10]<-"trending_date_final"


krd<-mutate(krd,pub<-substr(publish_time,1,10))
colnames(krd)[11]<-"pub"
krd$pub<-as.Date(krd$pub)
krd<-mutate(krd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(krd$gov)[2])
q3<-as.vector(summary(krd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

krdgov_prep<-krd[-as.vector(which(krd$gov>shangjie)),]
krgov<-krdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
krgov<-left_join(krgov,cacategoryname,by="category_id")
krgov<-krgov[-15,]

ggplot(krgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 47. Korea")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#India
indd<-ind%>%mutate(p1<-paste(str_sub(as.character(ind$trending_date),1,2),str_sub(as.character(ind$trending_date),7,8),str_sub(as.character(ind$trending_date),4,5),sep="-"))
indd<-indd%>%mutate(p2<-paste("20",indd$`... <- NULL`,sep = ""))
indd<-indd[,-c(9:26)]
colnames(indd)[9]<-"trendingdate"
colnames(indd)[10]<-"trending_date_final"



indd<-mutate(indd,pub<-substr(publish_time,1,10))
colnames(indd)[11]<-"pub"
indd$pub<-as.Date(indd$pub)
indd<-mutate(indd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(indd$gov)[2])
q3<-as.vector(summary(indd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

inddgov_prep<-indd[-as.vector(which(indd$gov>shangjie)),]
indgov<-inddgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
indgov<-left_join(indgov,cacategoryname,by="category_id")
indgov<-indgov[!is.na(indgov$category_name),]

ggplot(indgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 48. India")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#us
usd<-us%>%mutate(p1<-paste(str_sub(as.character(us$trending_date),1,2),str_sub(as.character(us$trending_date),7,8),str_sub(as.character(us$trending_date),4,5),sep="-"))
usd<-usd%>%mutate(p2<-paste("20",usd$`... <- NULL`,sep = ""))
colnames(usd)[9]<-"trendingdate"
usd<-usd%>%mutate(as.Date(trendingdate))
colnames(usd)[10]<-"trending_date_final"


usd<-mutate(usd,pub<-substr(publish_time,1,10))
colnames(usd)[12]<-"pub"
usd$pub<-as.Date(usd$pub)
usd<-mutate(usd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(usd$gov)[2])
q3<-as.vector(summary(usd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

usdgov_prep<-usd[-as.vector(which(usd$gov>shangjie)),]
usgov<-usdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
usgov<-left_join(usgov,uscategoryname,by="category_id")

ggplot(usgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 49. United States")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))

#UK
gbd<-gb%>%mutate(p1<-paste(str_sub(as.character(gb$trending_date),1,2),str_sub(as.character(gb$trending_date),7,8),str_sub(as.character(gb$trending_date),4,5),sep="-"))
gbd<-gbd%>%mutate(p2<-paste("20",gbd$`... <- NULL`,sep = ""))
gbd<-gbd[,-c(9:34)]
colnames(gbd)[9]<-"trendingdate"
colnames(gbd)[10]<-"trending_date_final"




gbd<-mutate(gbd,pub<-substr(publish_time,1,10))
colnames(gbd)[11]<-"pub"
gbd$pub<-as.Date(gbd$pub)
gbd<-mutate(gbd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(gbd$gov)[2])
q3<-as.vector(summary(gbd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

gbdgov_prep<-gbd[-as.vector(which(gbd$gov>shangjie)),]
gbgov<-gbdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
gbgov<-left_join(gbgov,cacategoryname,by="category_id")

ggplot(gbgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 50. United Kingdom")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7,angle = 90),axis.text.y=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=10))



```


## 4. Category Selection

According to previous analyses, different Top 5 categories are generated under different criteria (we can see this more clearly in the **shiny app**, where I put four criteria of a country in one screen), therefore, a comprehensive evalution is needed. 

 **Method**
<br>

* In the evaluation matrix, I took view pattern, user participation and trending lifecycle into account and pick the variables below.
* Used the reverse ranking of each attribute as its score for categories, and then summed up all the scores to get a final score of each category to select most valuable category to do further analysis.


```{r,fig.height = 3.5, fig.width = 3.5}
#Take U.S. as example
#ranking by views



category_count<-uss%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
us_category_count<-mutate(category_count,ranking=rank(n))

#ranking by voting rate and comment rate 
us_cv_rate_ranking<-uss%>%group_by(category_name)%>%summarise(sum(likes),sum(dislikes),sum(comment_count),sum(as.numeric(views)))
colnames(us_cv_rate_ranking)<-c("category_name","likes","dislikes","comments", "views")
us_cv_rate_ranking<-mutate(us_cv_rate_ranking,av=(likes+dislikes)/views,cv=comments/views)
us_cv_rate_ranking<-us_cv_rate_ranking[order(us_cv_rate_ranking$av,decreasing = TRUE),]
us_cv_rate_ranking<-mutate(us_cv_rate_ranking,av_ranking=rank(av))

us_cv_rate_ranking<-us_cv_rate_ranking[order(us_cv_rate_ranking$cv,decreasing = TRUE),]
us_cv_rate_ranking<-mutate(us_cv_rate_ranking,cv_ranking=rank(cv))



#ranking by going-viral time
usgov<-usgov[order(usgov$govtime),]
usgov<-mutate(usgov,gv_ranking=length(govtime)-rank(govtime)+1 )





#Construct evaluation matrix
us_matrix<-left_join(us_category_count,us_cv_rate_ranking,by="category_name")
us_matrix<-us_matrix[,-c(4:9)]
us_matrix<-left_join(us_matrix,usgov,by="category_name")
us_matrix<-us_matrix[,c(1,3,4,5,8)]
us_matrix<-mutate(us_matrix,total_score=ranking+av_ranking+cv_ranking+gv_ranking)
us_matrix<-us_matrix[order(us_matrix$total_score,decreasing = TRUE),]
colnames(us_matrix)<-c("Category_name","Views","VotingRate","CommentRat","GoingViralTime","Total_Score")
library(knitr)
kable(us_matrix,align = "c",format="markdown",caption="Evaluation Matrix-U.S.",booktabs = TRUE)
```

**Findings**
<br>

* In the U.S., **How to & Style, Gaming and Comedy** are among Top 3 popular categories based on evaluation matrix, which partly different from the previous EDA, i.e. music, entertainment and gaming videos’influence continues. 

* **How to & Style and Comedy**  become new hitmakers and thus may be the next potential categories for advertisers.
  


# Text Analysis for trending video title in U.S.

* "Official", "trailer", "makeup" are Top 3 popular words used in YouTube Trending Videos' titles.
* Negative sentiment is slightly more than the positive one.

(If the wordcloud fails to be loaded, try uploading from the local derectly. And the code for making wordcloud is in the next chunk.)
```{r echo=FALSE,fig.align="c", fig.show='hold',fig.cap="Wordcloud", out.width = '100%'}
knitr::include_graphics("wordcloud.png")

```


```{r,fig.height = 5, fig.width = 8 }
us_title<-read.csv("US Title.csv",header=TRUE,stringsAsFactors=FALSE)
colnames(us_title)<-"text"
us_title_text<-unnest_tokens(us_title,title,text)

#delete letters with length<=2
us_title_text<-filter(us_title_text,nchar(title)>2)
#delete non-letters
us_title_text<-str_extract(as.character(us_title_text$title),"[a-z]+")
us_title_text<-as.data.frame(us_title_text)
colnames(us_title_text)<-"text"
#count word frequency
us_title_text_count<-us_title_text%>%count(text,sort=TRUE)
#delete stopwords
us_title_text<-setdiff(us_title_text$text,stop_words$word)
us_title_text<-as.data.frame(us_title_text)
colnames(us_title_text)<-"text"
#combine clean words and their frequency
us_title_text_clean_count<-left_join(us_title_text,us_title_text_count,by="text")
c<-which(us_title_text_clean_count$text=="video")
us_title_text_clean_count<-us_title_text_clean_count[-c,]
us_title_text_clean_count<-filter(us_title_text_clean_count,text!="null")
#wordcloud output
my_graph<-wordcloud2(us_title_text_clean_count,color="random-light",backgroundColor="white",shape = 'circle')
saveWidget(my_graph, "tmp.html", selfcontained = F)
webshot::webshot("tmp.html", "wc1.png", delay = 5)
print(my_graph)


#Visualize top 10 words on YouTube trending video
us_title_text_clean_count<-us_title_text_clean_count[order(us_title_text_clean_count$n,decreasing = TRUE),]
us_title_text_clean_count_top20<-us_title_text_clean_count[2:21,]
ggplot(us_title_text_clean_count_top20,aes(x=reorder(text,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Top 20 Popular Words of YouTube Trending Videos' Titles")+
  labs(x="Words", y="Frequency")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=7))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

#sentimental analysis
title_sentiment <-us_title_text_clean_count %>%inner_join(get_sentiments("bing"),by=c("text"="word"))

title_sentiment %>%
  filter(n > 100) %>%
  mutate(n = ifelse(sentiment == "negative", -n, n)) %>%
  mutate(word = reorder(text, n))%>%ggplot(aes(x=reorder(text,-n),y=n,fill = sentiment))+geom_col() +coord_flip() +labs(x="Word",y = "Contribution to sentiment")+labs(title="Sentimental Analysis for YouTube Trending Video Title")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

#calculate the percentage of negative and positive 
title_sentiment_count<-title_sentiment%>%group_by(sentiment)%>%summarise(geshu=sum(n))

myLabel = as.vector(title_sentiment_count$sentiment) 
myLabel<-paste(myLabel, "(", round(title_sentiment_count$geshu/sum(title_sentiment_count$geshu) * 100, 0),"%)", sep = "")   

ggplot(title_sentiment_count, aes(x = "", y =geshu, fill=sentiment)) + 
  geom_bar(stat = "identity", width = 1) +    
  coord_polar(theta = "y") + 
  labs(x = "", y = "", title = "Contribution to sentiment")+labs(title="Sentimental Analysis for YouTube Trending Video Title (%)") + 
  theme(axis.ticks = element_blank()) + 
  theme(legend.title = element_blank(), legend.position = "top")+
  scale_fill_discrete(breaks=title_sentiment_count$sentiment,labels=myLabel)+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank())+theme(panel.grid=element_blank(),axis.text.x = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]),labels=myLabel)




```


# Conclusion

* View Pattern:
Entertainment, music, gaming and auto gain most popularity in 10 countries.

- User Participation:
The average voting rate, 3% of ten countries is 10 times of the average comment rate,0.3%.

- Trending Lifecycle:
The time interval of both going-viral and keeping trending ranges from 1 day to 2 weeks.

- Category Selection:
Entertainment, music, film and animation have the most business potential based on overall performance.

- Text Analysis of YouTube Trending Videos' Titles
  + Top 3 popular words: "official", "trailer", "makeup";
  + Negative sentiment > Positive sentiment.

